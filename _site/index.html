<!DOCTYPE html><html><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1"><title>Upstream</title><link href="https://fonts.googleapis.com/css?family=Lato:900|Work+Sans" rel="stylesheet"><link rel="stylesheet" href="/css/main.css"><title>Upstream</title><meta property="og:title" content="Upstream" /><link rel="canonical" href="http://localhost:4000/" /><meta property="og:url" content="http://localhost:4000/" /><meta property="og:site_name" content="Upstream" /><script type="application/ld+json"> {"@context": "http://schema.org", "@type": "WebSite", "name": "Upstream", "headline": "Upstream", "url": "http://localhost:4000/"}</script></head><body style="background-color: rgb(255, 255, 255)"><script src="/js/theme.min.js"></script><header> <a href="/"><div class="home"></div></a></header><h1 class="headline">Upstream</h1><h3><article><header><a href="/2017/02/13/testing-dropwizard-ui-apps-in-memory.html">Testing Dropwizard UI Apps in Memory</a></h3></header><div><p>If you’re in <a href="https://darrenhobbs.com/2006/04/22/a-bad-citizen-in-javaland/">javaland</a>, you can do a lot worse than <a href="http://www.dropwizard.io/1.0.6/docs/">Dropwizard</a>.</p><p>A simple, lightweight web service framework built on top of Jersey with an all-star cast of mature java libraries in supporting roles.</p><p><strong>In-process testing</strong> is <em>the</em> essential technique for fast feedback when writing software. It involves having a test process (e.g. Junit) start your application and hosting it in-memory, firing requests at the app directly from an in-memory test client.</p><p>No packaging of the application. No deployment. No network IO for requests. Direct access to the application to mock external dependencies. Mock behaviour defined in code, sitting with your tests.</p><p>You can have a comprehensive, large-scale test suite run in <em>seconds</em>, which when multiplying that by the team size and number of pushes a day, is a backbone of time-saving techniques that power high-performing teams.</p><p>Dropwizard already has out-of-the-box support for in-process testing, but:</p><ul><li>testing UIs and user journeys is hard (sequential actions, form posts, persistent cookies, dealing with html, does the javascript work etc)</li><li>no support for dependency switching</li></ul><p>Here’s a tutorial for how to set up a DI-switchable integration test harness with Dropwizard and Guice, and as an added bonus, how to set that up for UI apps so you can use webdriver in-memory too.</p><p>Set-up:</p><p>`</p><div class="highlighter-rouge"><pre class="highlight"><code>compile "com.hubspot.dropwizard:dropwizard-guice:1.0.0.3",
        "io.dropwizard:dropwizard-core:1.0.6",
        "io.dropwizard:dropwizard-views:1.0.6",
        "io.dropwizard:dropwizard-views-freemarker:1.0.6",
        "io.dropwizard:dropwizard-client:1.0.6",
        "io.dropwizard:dropwizard-assets:1.0.6",
        "io.dropwizard:dropwizard-metrics-graphite:1.0.6",
        "com.palominolabs.metrics:metrics-guice:3.1.3"
		
testCompile "junit:junit-dep:4.11",
            "org.mockito:mockito-core:1.9.5",
            "io.dropwizard:dropwizard-testing:1.0.6",
            "com.thoughtworks.inproctester:jerseytester-webdriver:1.1.0",
            "com.thoughtworks.inproctester:jerseytester-htmlunit:1.1.0" `
</code></pre></div><ol><li>have tests use custom rule builder</li></ol><div class="language-java highlighter-rouge"><pre class="highlight"><code>
<span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">testupstream</span><span class="o">.</span><span class="na">app</span><span class="o">.</span><span class="na">integration</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">com.testupstream.app.integration.steps.IntegrationTests</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.junit.Test</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.openqa.selenium.By</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">static</span> <span class="n">org</span><span class="o">.</span><span class="na">hamcrest</span><span class="o">.</span><span class="na">core</span><span class="o">.</span><span class="na">Is</span><span class="o">.</span><span class="na">is</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">static</span> <span class="n">org</span><span class="o">.</span><span class="na">junit</span><span class="o">.</span><span class="na">Assert</span><span class="o">.</span><span class="na">assertThat</span><span class="o">;</span>


<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ExampleIntegrationTest</span> <span class="kd">extends</span> <span class="n">IntegrationTests</span> <span class="o">{</span>

    <span class="nd">@Test</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">homepageShouldHaveGoodbyeWorld</span><span class="o">()</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
        <span class="n">driver</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="s">"http://localhost:9998/"</span><span class="o">);</span>
        <span class="n">assertThat</span><span class="o">(</span><span class="n">driver</span><span class="o">.</span><span class="na">findElement</span><span class="o">(</span><span class="n">By</span><span class="o">.</span><span class="na">tagName</span><span class="o">(</span><span class="s">"h1"</span><span class="o">)).</span><span class="na">getText</span><span class="o">(),</span> <span class="n">is</span><span class="o">(</span><span class="s">"Goodbye, World!"</span><span class="o">));</span>
    <span class="o">}</span>

<span class="o">}</span>

</code></pre></div><p>Enter <a href="https://github.com/aharin/jerseytester">jerseytester</a>. This library provides a webdriver interface on top of JerseyTest, jersey’s own in process test harness that dropwizard builds its test tools upon.</p></div></article><h3><article><header><a href="/2017/02/10/starting-new.html">Starting New</a></h3></header><div><p>Hey! I’ve decided to give the blog a facelift.</p><p>I might bring posts from the old site over, I don’t know - it’s still good to laugh at what i was wrong about.</p><p>More soon.</p></div></article><footer><div class="links"> <a href="/about/">About</a> <a href="/contact/">Contact</a></div><div class="theme" onclick="theme()" style=" background-image: url(/images/theme.svg)"></div></footer><script> (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){ (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o), m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m) })(window,document,'script','//www.google-analytics.com/analytics.js','ga'); ga('create', 'blah', 'auto'); ga('send', 'pageview');</script></body></html>
